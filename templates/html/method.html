<!DOCTYPE html>
<html>
    <head>
        <link href="../css/family.css" rel="stylesheet">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fauna+One">
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script type="text/javascript" src="../js/family.js"></script>
    </head>
    
    <body>
        <div class="navbar">
            <ul class="navbar">
                <li class="navbar" id="logo"><a href="https://github.com/bergmanlab/mcclintock" target="_blank" class="logo">McClintock</a></li>
                <li class="navbar"><a href="../summary.html" class="navbar">Summary</a></li>
                <li class="navbar"><a href="families.html" class="navbar">TE Families</a></li>
                <li class="navbar dropdown">
                    <a href="#" class="navbar dropdown">TE Detection Methods</a>
                    <div class="dropdown-content">
                        {% for m in methods %}
                            <a href="{{ m }}.html" class="dropdown-content">{{ m }}</a>
                        {% endfor %}
                    </div>
                </li>
            </ul> 
        </div>

        <div class="row">
            <div class="sidebar">
                <ul class="sidebar">
                    <li class="sidebar"><a href="#plot1Header" class="sidebar">Family Prediction Summary</a></li>
                    <li class="sidebar"><a href="#plot2Header" class="sidebar">Predictions Per Contig</a></li>
                    <li class="sidebar"><a href="#predictionHeader" class="sidebar">{{method}} Prediction</a></li>
                </ul>
            </div>
            <div class="main">
                <div class="pageHeader">
                    <p class="pageHeader">{{method}}</p>
                </div>
                <div class="spacer2"></div>
                <div class="sectionHeader">
                    <a href="../data/methods/{{ method }}/family_predictions.txt"  target="_blank"><div class="sectionHeaderRaw">Raw</div></a>
                    <div class="sectionHeaderName">Family Prediction Summary</div>
                    <div class="sectionHeaderHide" id="plot1Header" onclick="hide('plot1Div','plot1Header')">Hide</div>
                </div>
                <div id="plot1Div">
                    <div class="runinfo" id="teinfo">
                        <div id="tester" class="plot1" style="width:100%;height:500px;"></div>
                    </div>
                </div>
                <div class="spacer2"></div>
                <div class="sectionHeader">
                    <a href="../data/methods/{{ method }}/contig_predictions.txt"  target="_blank"><div class="sectionHeaderRaw">Raw</div></a>
                    <div class="sectionHeaderName">Predictions Per Contig</div>
                    <div class="sectionHeaderHide" id="plot2Header" onclick="hide('plot2Div','plot2Header')">Hide</div>
                </div>
                <div id="plot2Div">
                    <div class="runinfo" id="teinfo">
                        <div id="tester" class="plot2" style="width:100%;height:500px;"></div>
                    </div>
                </div>
                <div class="spacer2"></div>
                <div class="sectionHeader">
                    <a href="../data/methods/{{ method }}/all_predictions.txt"   target="_blank"><div class="sectionHeaderRaw">Raw</div></a>
                    <div class="sectionHeaderName">{{ method }} Predictions</div>
                    <div class="sectionHeaderHide" id="predictionHeader" onclick="hide('familyinfoDiv','predictionHeader')">Hide</div>
                </div>
                <div id="familyinfoDiv">
                    <div class="filter">
                        <input type="text" class="filterTable" id="filterTable1" autocomplete="off" onkeyup="filterTableExtended('filterTable1','filterTable2','predictionsTable', 'exactBox2','refBox','nonrefBox','filterOption')" placeholder="Filter">
                        <input type="button" id="filterOption" class="filterOption" name="filterOption" value="and" onclick="flipFilterOption('filterOption');filterTableExtended('filterTable1','filterTable2','predictionsTable', 'exactBox2','refBox','nonrefBox','filterOption');">
                        <input type="text" class="filterTable" id="filterTable2" autocomplete="off" onkeyup="filterTableExtended('filterTable1','filterTable2','predictionsTable', 'exactBox2','refBox','nonrefBox','filterOption')" placeholder="Filter">
                        <input type="checkbox" class="checkbox" id="exactBox2" name="exactBox2" autocomplete="off" onclick="filterTableExtended('filterTable1','filterTable2','predictionsTable', 'exactBox2','refBox','nonrefBox','filterOption')">
                        <label for="exactBox2">Exact Match</label>
                        <input type="checkbox" class="checkbox" id="refBox" name="refBox" checked="checked" autocomplete="off" onclick="filterTableExtended('filterTable1','filterTable2','predictionsTable', 'exactBox2','refBox','nonrefBox','filterOption')">
                        <label for="exactBox2">Reference</label>
                        <input type="checkbox" class="checkbox" id="nonrefBox" name="nonrefBox" checked="checked" autocomplete="off" onclick="filterTableExtended('filterTable1','filterTable2','predictionsTable', 'exactBox2','refBox','nonrefBox','filterOption')">
                        <label for="exactBox2">Non-Reference</label>
                        
                    </div>
                    <div class="runinfo" id="predictions">
                        <table class="run-information" id="predictionsTable">
                            <tr>
                                <th class="header" onclick="sortTable('predictionsTable', 0)">Contig</th>
                                <th class="header" onclick="sortTable('predictionsTable', 1)">Family</th>
                                <th class="header" onclick="sortTable('predictionsTable', 2)">Type</th>
                                <th class="header" onclick="sortTable('predictionsTable', 3, numeric=true)">Start</th>
                                <th class="header" onclick="sortTable('predictionsTable', 4, numeric=true)">End</th>
                                <th class="header" onclick="sortTable('predictionsTable', 5, numeric=true)">Strand</th>
                            </tr>
                            {% for prediction in predictions %}
                                {% if loop.index%2 != 0 %}
                                    <tr>
                                        <td class="values">{{ prediction.chrom }}</td>
                                        <td class="values">{{ prediction.family }}</td>
                                        <td class="values">{{ prediction.type }}</td>
                                        <td class="values">{{ prediction.start }}</td>
                                        <td class="values">{{ prediction.end }}</td>
                                        <td class="values">{{ prediction.strand }}</td>
                                    </tr>
                                {% else %}
                                    <tr>
                                        <td class="values even">{{ prediction.chrom }}</td>
                                        <td class="values even">{{ prediction.family }}</td>
                                        <td class="values even">{{ prediction.type }}</td>
                                        <td class="values even">{{ prediction.start }}</td>
                                        <td class="values even">{{ prediction.end }}</td>
                                        <td class="values even">{{ prediction.strand }}</td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        </table>
                    </div>
                </div>
                <div class="spacer2"></div>
            </div>
        </div>
        <!-- plot 1: Family Summary -->
        <script>
            var trace1 = {
            x: [
                {% for count in reference_family_counts %}
                    {{count}},
                {% endfor %}
            ],
            y: [
                {% for family in families %}
                    '{{family}}',
                {% endfor %}
            ],
            name: 'Reference',
            orientation: 'h',
            marker: {
                color: 'rgba(25,25,25,0.6)',
                width: 1
            },
            type: 'bar'
            };

            var trace2 = {
            x: [
                {% for count in nonreference_family_counts %}
                    {{count}},
                {% endfor %}
            ],
            y: [
                {% for family in families %}
                    '{{family}}',
                {% endfor %}
            ],
            name: 'Non-Reference',
            orientation: 'h',
            type: 'bar',
            marker: {
                color: 'rgba(95,95,95,0.6)',
                width: 1
            }
            };

            var data = [trace1, trace2];

            var layout = {
            barmode: 'stack',
            showlegend: true,
            font: {size: 12},
            margin: {'t':50, 'b':50},
            xaxis: {automargin: true},
            yaxis: {automargin: true},
            legend: {"orientation": "h", x: 0.3, y: 1.1}
            };

            var div = document.getElementsByClassName('plot1')[0];
            Plotly.newPlot(div, data, layout);
        </script>

        <!-- plot 2: Chromosome Summary -->
        <script>
            var trace1 = {
            x: [
                {% for counts in reference_chromosome_counts %}
                    {{ counts }},
                {% endfor %}
            ],
            y: [
                {% for chromosome in chromosomes %}
                    '{{ chromosome }}',
                {% endfor %}
            ],
            name: 'Reference',
            orientation: 'h',
            marker: {
                color: 'rgba(25,25,25,0.6)',
                width: 1
            },
            type: 'bar'
            };

            var trace2 = {
            x: [
                {% for counts in nonreference_chromosome_counts %}
                    {{ counts }},
                {% endfor %}
            ],
            y: [
                {% for chromosome in chromosomes %}
                    '{{ chromosome }}',
                {% endfor %}
            ],
            name: 'Non-Reference',
            orientation: 'h',
            type: 'bar',
            marker: {
                color: 'rgba(95,95,95,0.6)',
                width: 1
            }
            };

            var data = [trace1, trace2];

            var layout = {
            barmode: 'stack',
            showlegend: true,
            font: {size: 12},
            margin: {'t':50, 'b':50},
            xaxis: {automargin: true},
            yaxis: {automargin: true},
            legend: {"orientation": "h", x: 0.3, y: 1.1}
            };

            var div = document.getElementsByClassName('plot2')[0];
            Plotly.newPlot(div, data, layout);
        </script>
    </body>

</html>